\RequirePackage{xparse}
\RequirePackage{mathtools}
\RequirePackage{amssymb}
\RequirePackage{esint}
\RequirePackage{siunitx}
\RequirePackage{tensor}
\RequirePackage{slashed}

%------------------------------------------------------------
% SIUNITX SETUP
%------------------------------------------------------------
\sisetup{separate-uncertainty=true}

%------------------------------------------------------------
% GROUPS, ALGEBRAS & SETS
%------------------------------------------------------------
% Number sets
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\E}{\mathbb{E}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\A}{\mathbb{A}}
\newcommand{\F}{\mathbb{F}} % Finite field

% Special spaces and other sets
\newcommand{\Ball}{\mathbb{B}} % Ball
\newcommand{\Disc}{\mathbb{D}} % Disc
\newcommand{\Hilbert}{\mathcal{H}} % Hilbert Space

\newcommand{\CP}{\mathbb{C}\mathrm{P}} % Complex Projective
\newcommand{\RP}{\mathbb{R}\mathrm{P}} % Real Projective

% Matrix groups
\newcommand{\GL}{\mathrm{GL}}
\newcommand{\Mat}{\mathrm{Mat}}
\newcommand{\Orth}{\mathrm{O}}
\newcommand{\PGL}{\mathrm{PGL}}
\newcommand{\PSL}{\mathrm{PSL}}
\newcommand{\PSO}{\mathrm{PSO}}
\newcommand{\PSU}{\mathrm{PSU}}
\newcommand{\SL}{\mathrm{SL}}
\newcommand{\SO}{\mathrm{SO}}
\newcommand{\Spin}{\mathrm{Spin}}
\newcommand{\Sp}{\mathrm{Sp}}
\newcommand{\SU}{\mathrm{SU}}
\newcommand{\U}{\mathrm{U}}

% Other groups
\newcommand{\Dih}[1]{\mathrm{D}_{#1}}
\newcommand{\Sym}[1]{\mathrm{S}_{#1}}

% Matrix algebras
\newcommand{\Lie}[1]{\mathfrak{#1}}

% Group theory symbols
\newcommand{\subgroup}{\mathrel{\leq}}
\newcommand{\nsubgroup}{\mathrel{\trianglelefteq}}
\DeclarePairedDelimiter{\cyclic}{\langle}{\rangle}
\newcommand{\cat}[1]{\mathsf{#1}} % categories

%------------------------------------------------------------
% VARIOUS BRACKETS
%------------------------------------------------------------
% General
% \DeclarePairedDelimiter{\paren}{\lparen}{\rparen}
% \DeclarePairedDelimiter{\cparen}{\lbrace}{\rbrace}
% \DeclarePairedDelimiter{\bparen}{\lbrack}{\rbrack}
\DeclarePairedDelimiterX{\paren}[1]{\lparen}{\rparen}{\ifblank{#1}{\:\dots\:}{#1}}
\DeclarePairedDelimiterX{\cparen}[1]{\lbrace}{\rbrace}{\ifblank{#1}{\:\dots\:}{#1}}
\DeclarePairedDelimiterX{\bparen}[1]{\lbrack}{\rbrack}{\ifblank{#1}{\:\dots\:}{#1}}

% \DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
% \DeclarePairedDelimiter{\norm}{\lVert}{\rVert}
% \DeclarePairedDelimiter{\inner}{\langle}{\rangle}
% \DeclarePairedDelimiter{\mean}{\langle}{\rangle}
% \DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
% \DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}
\DeclarePairedDelimiterX{\abs}[1]{\lVert}{\rVert}{\ifblank{#1}{\:\cdot\:}{#1}}
\DeclarePairedDelimiterX{\norm}[1]{\lVert}{\rVert}{\ifblank{#1}{\:\cdot\:}{#1}}
\DeclarePairedDelimiterX{\inner}[1]{\langle}{\rangle}{\ifblank{#1}{\:\cdot\:,\:\cdot\:}{#1}}
\DeclarePairedDelimiterX{\mean}[1]{\langle}{\rangle}{\ifblank{#1}{\:\cdot\:}{#1}}
\DeclarePairedDelimiterX{\ceil}[1]{\lceil}{\rceil}{\ifblank{#1}{\:\cdot\:}{#1}}
\DeclarePairedDelimiterX{\floor}[1]{\lfloor}{\rfloor}{\ifblank{#1}{\:\cdot\:}{#1}}

\DeclareDocumentCommand{\at}{O{}m}{#1\rvert_{#2}}

% Set brackets
% Older def.
% \DeclarePairedDelimiter{\set}{\lbrace}{\rbrace}
\newcommand\SetSymbol[1][]{\nonscript\:#1\vert\allowbreak\nonscript\:\mathopen{}}
\providecommand\st{}
\DeclarePairedDelimiterX{\set}[1]{\lbrace}{\rbrace}{\renewcommand\st{\SetSymbol[\delimsize]}#1}

% Quantum Mechanics
\DeclarePairedDelimiter{\comm}{\lbrack}{\rbrack}
\DeclarePairedDelimiter{\acomm}{\lbrace}{\rbrace}

% Dirac brackets
\DeclarePairedDelimiter{\bra}{\langle}{\rvert}
\DeclarePairedDelimiter{\ket}{\lvert}{\rangle}

% Older def.
% \DeclareDocumentCommand{\braket}{mom}{
%   \IfValueTF{#2}
%     {\left\langle#1\right\rvert#2\left\lvert#3\right\rangle}
%     {\left\langle#1\middle\rvert#3\right\rangle}
% }
\DeclarePairedDelimiterX{\braket}[3]{\langle}{\rangle}{#1\,\ifblank{#2}{}{\delimsize\vert\,\mathopen{}#2\,}\delimsize\vert\,\mathopen{}#3}

\DeclarePairedDelimiterXPP{\nord}[1]{N}{\lbrace}{\rbrace}{}{#1}
\DeclarePairedDelimiterXPP{\tord}[1]{T}{\lbrace}{\rbrace}{}{#1}

\newcommand{\qop}[1]{\hat{#1}}
\newcommand{\qdagger}[1]{\hat{#1}^{\dagger}}

\newcommand{\qbar}[1]{\overline{#1}} % adjoint such as \psi-bar
\newcommand{\anti}[1]{\overline{#1}} % antiparticle

%------------------------------------------------------------
% VARIOUS OPERATORS
%------------------------------------------------------------
\renewcommand{\d}{\mathop{}\!\mathrm{d}} % upright dx
\newcommand{\pd}{\partial} % shortcut for the \partial
\DeclareMathOperator{\alemb}{\square} % shortcut for the \square
\newcommand{\Int}{\int\limits} % integral with display limits
\newcommand{\compose}{\mathbin{\circ}} % composition of functions

\newcommand{\isom}{\mathrel{\cong}} % isomorphism
\newcommand{\homeo}{\mathrel{\cong}} % homeomorphism

\DeclareMathOperator{\Tr}{Tr} % Trace
\DeclareMathOperator{\img}{im} % Image
\DeclareMathOperator{\rank}{rank} % Rank
\DeclareMathOperator{\adj}{adj}
\DeclareMathOperator{\ad}{ad}

\DeclareMathOperator{\Arg}{Arg}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\supp}{supp}
\DeclareMathOperator*{\res}{res} % Residue
\DeclareMathOperator{\lcm}{lcm}

\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\Inn}{Inn}
\DeclareMathOperator{\Ann}{Ann}
\DeclareMathOperator{\End}{End}
\DeclareMathOperator{\sign}{sgn}

% Probability and statistics
\let\P\relax
\DeclareMathOperator{\P}{\mathbb{P}}
\DeclareMathOperator{\expected}{\mathbf{E}}
\DeclareMathOperator{\variance}{\mathbf{Var}}

% \det is determinant (already defined)
% \ker is kernal (already defined)
% \arg (already defined)

\DeclareMathOperator{\cosec}{cosec}
\DeclareMathOperator{\cosech}{cosech}
\DeclareMathOperator{\sech}{sech}

% Alternative inverse trigonometric functions
\DeclareMathOperator{\asin}{{sin}^{-1}}
\DeclareMathOperator{\acos}{{cos}^{-1}}
\DeclareMathOperator{\atan}{{tan}^{-1}}
\DeclareMathOperator{\acot}{{cot}^{-1}}
\DeclareMathOperator{\acsc}{{csc}^{-1}}
\DeclareMathOperator{\asec}{{sec}^{-1}}

% Alternative inverse hyperbolic functions
\DeclareMathOperator{\asinh}{{sinh}^{-1}}
\DeclareMathOperator{\acosh}{{cosh}^{-1}}
\DeclareMathOperator{\atanh}{{tanh}^{-1}}
\DeclareMathOperator{\acoth}{{coth}^{-1}}
\DeclareMathOperator{\acsch}{{csch}^{-1}}
\DeclareMathOperator{\asech}{{sech}^{-1}}

% Logrithm
% \log -> log (already defined)
% \ln -> ln (already defined)
\DeclareMathOperator{\Log}{Log}

% Some other functions
\DeclareMathOperator{\erf}{erf}
\DeclareMathOperator{\erfc}{erfc}

% Complex Components
\let\Re\relax
\let\Im\relax
\DeclareMathOperator{\Re}{Re}
\DeclareMathOperator{\Im}{Im}
\newcommand{\conj}[1]{\overline{#1}}

%------------------------------------------------------------
% ABBREVIATIONS AND SUCH
%------------------------------------------------------------
\newcommand{\B}{\mathcal{B}}
\newcommand{\BigO}{\mathcal{O}} % Big-O notation
\newcommand{\D}{\mathcal{D}}
\newcommand{\Der}{\mathrm{Der}} % Derivation
\newcommand{\id}{\mathrm{id}} % Identity element
\newcommand{\Id}{\mathrm{Id}} % Identity element (another one)
\newcommand{\Lag}{\mathcal{L}}
\newcommand{\Ham}{\mathcal{H}}
\newcommand{\pt}{\{\mathrm{pt}\}} % Point
\newcommand{\vol}{\mathrm{vol}} % Volume

\newcommand{\qeq}{\stackrel{?}{=}} 
\newcommand{\ifeq}{\mathrel{``{=}"}} 

%------------------------------------------------------------
% VECTORS, DERIVATIVES AND SUCH
%------------------------------------------------------------

% Vectors
\let\oldvec\vec
\renewcommand{\vec}[1]{\boldsymbol{\mathbf{#1}}}
\newcommand{\uvec}[1]{\boldsymbol{\mathbf{\hat{#1}}}}

% Derivatives
\let\divsymb\div
\renewcommand{\div}{\nabla\cdot}
\newcommand{\curl}{\nabla\times}
\newcommand{\lap}{\nabla^2}
\newcommand{\grad}{\nabla}

% \newcommand{\st}[1][|]{\,#1\,} % (older) for the set builder notation
\newcommand{\closure}[1]{\overline{#1}}
\newcommand{\interior}[1]{{#1}^{\circ}}

%-------------------------------------------------------------
% COLOURS
%-------------------------------------------------------------
\RequirePackage{xcolor}
\definecolor{lightgray}{RGB}{211,211,211}
\definecolor{darkgray}{RGB}{64,64,79}
\definecolor{gold}{RGB}{255,204,0}
\definecolor{orange}{RGB}{255,103,0}
\definecolor{red}{RGB}{255,0,0}
\definecolor{pink}{RGB}{255,182,193}
\definecolor{crimson}{RGB}{211,0,63}
\definecolor{trueblue}{RGB}{0,47,167}
\definecolor{teal}{RGB}{0,128,128}
\definecolor{truegreen}{RGB}{0,102,0}

%-------------------------------------------------------------
% SHORT MACROS
%-------------------------------------------------------------
\def\strike{\bgroup \ULdepth=-.55ex \ULset} % Strike through
\newcommand{\missing}[1]{{\color{red}#1}}
\newcommand{\keyword}[1]{\textsf{#1}}
